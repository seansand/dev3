//pebblecards.groovy

//See: https://keanulee.com/pebblecards/#api

/* example

{
  "content" : "Hello John,\nWelcome to Cards for Pebble!",
  "refresh_frequency" : 30,   // Optional, in minutes
  "vibrate" : 1               // Optional
}

*/

String fullList = '''A blind man once stepped on Bad Horse‘s iron hoof. Bad Horse whinnied, “Don’t you know who I am? I’m Bad Horse!” The mere mention of his name (even in whinny language) cured this man blindness. Sadly the first, last, and only thing this man ever saw, was a fatal trampling delivered by Bad Horse.
A Disabled parking sign does not signify that this spot is for handicapped people. It is actually in fact a warning, that the spot belongs to Bad Horse and that you will be disabled if you park there.
Apple pays Bad Horse 99c every time he listens to a song.
At birth, Bad Horse came out feet first so he could give the veterinarian some iron hoof to the face. Nobody delivers Bad Horse but Bad Horse.
Bad Horse always gets blackjack. Even when he’s playing poker.
Bad Horse can divide by zero.
Bad Horse can kill two stones with one bird.
Bad Horse can lead a human to water AND make it drink. At iron hoof-point.
Bad Horse can open beer cans with his teeth. He still prefers to use other people’s teeth, though.
Bad Horse can slam a revolving door.
Bad Horse can sneeze with his eyes open.
Bad Horse can speak Braille.
Bad Horse clogs the toilet even when he pisses.
Bad Horse counted to infinity – twice. In whinnies.
Bad Horse destroyed the periodic table, because he only recognizes the element of badassery.
Bad Horse died ten years ago, but the Grim Reaper can’t get up the courage to tell him.
Bad Horse does not get frostbite. Bad Horse bites frost
Bad Horse does not hunt because the word hunting implies the probability of failure. Bad Horse goes killing.
Bad Horse does not know where you live, but he knows where you will die.
Bad Horse does not leave messages. Bad Horse leaves warnings.
Bad Horse does not sleep. He waits.
Bad Horse doesn’t wear a watch, HE decides what time it is.
Bad Horse doesn’t give Christmas presents. If you live to see Christmas, that is your Christmas present from Bad Horse.
Bad Horse doesn’t have a bank account. He just tells the bank how much he needs.
Bad Horse doesn’t read books. He whinnies at them until he gets the information he wants.
Bad Horse doesn’t understand why you should consult your doctor if your erection lasts for more than 4 hours. His erections have been known to last for up to 15 days.
Bad Horse ends every relationship with “Its not me, its you”.
Bad Horse frequently donates blood to the Red Cross. Just never his own.
Bad Horse got in touch with his feminine side, and promptly got her pregnant.
Bad Horse has never had an alcohol problem. However, alcohol has had a Bad Horse problem.
Bad Horse has to sort his washing into three loads: darks, whites, and bloodstains.
Bad Horse is allowed to talk about Fight Club.
Bad Horse is currently in a legal battle with the makers of Bubble Tape. Bad Horse claims “6 Feet of Fun” is actually the trademark for his penis.
Bad Horse is hung like a horse. Duh.
Bad Horse is so fast, he can run around the world and give himself some iron hoof to the arse.
Bad Horse is suing Myspace for taking the name of what he calls everything around you.
Bad Horse is the reason why Waldo is hiding.
Bad Horse never gets brain freeze. Slurpees know when to back the frak off.
Bad Horse once had a near death experience. Needless to say, Death now refuses to come near him.
Bad Horse once visited the Virgin Islands. They are now The Islands With A Reputation For Bestiality.
Bad Horse once went on Who Wants To Be A Millionare? and answered, “Bad Horse” to every question. D’you need me to tell you the rest?
Bad Horse only uses one chopstick.
Bad Horse owns the greatest Poker Face of all-time. It helped him win the 1983 World Series of Poker despite him holding just a Joker, a Get out of Jail Free Monopoloy card, a 2 of clubs, 7 of spades and a green #4 card from the game UNO. In his hoof.
Bad Horse puts the “laughter” in “manslaughter”.
Bad Horse refers to himself in fourth person.
Bad Horse sleeps with a night light. Not because Bad Horse is afraid of the dark, but the dark is afraid of Bad Horse
Bad Horse sold his soul to the devil for thoroughbred status and his general badassery. Shortly after the transaction was finalised, Bad Horse trampled the devil in the face and took his soul back. The devil, who appreciates irony, couldn’t stay mad and admitted he should have seen it coming. They now play poker every second Wednesday of the month.
Bad Horse‘s sperm can penetrate 13 condoms, the birth control pill, a brick wall, the All Blacks, and the several million years of parallel genetic evolution in order to impregnate a woman.
Bad Horse‘s tears cure cancer. Too bad he has never cried.
Bad Horse uses all seven letters in Scrabble. Every turn.
Bad Horse was once on Celebrity Wheel of Fortune and was the first to spin. The next 29 minutes of the show consisted of everyone standing around awkwardly, waiting for the wheel to stop.
Bad Horse was sending an email one day, when he realised that it would be faster to gallop.
Bad Horse, Chuck Norris and Arnold Schwarzenegger have all died and are in Heaven. Each of them hope to occupy the seat next to God. God asks Chuck Norris why he thinks he should have the seat and Chuck replies, “I believe… I should have the seat because of my rugged good looks and unparalleled martial arts ability.” Arnie says, “I believe… that I should be the one sitting next to you because of all my achievements.” God then turns to Bad Horse, who replies with, “I believe… you have placed a gaudy throne in my spot.”
Bad Horse’s hoof is the only hand that can beat a Royal Flush.
Bad Horse‘s iron hoofs are made from the skin of Tony Stark.
Contrary to popular belief, America is not a democracy, it is a Bad Horsetatorship.
Filming on location for Dr. Horrible’s Sing-Along Blog, Bad Horse brought a stillborn baby lamb back to life by giving it a prolonged hoof rub. Shortly after the farm animal sprang back to life and a crowd had gathered, Bad Horse trampled the animal, breaking its neck, to remind the crew once more that Bad Horse giveth, and the Bad Horse, he taketh away.
AAMI saved 15% by switching to Bad Horse.
If at first you don’t succeed, you are obviously not Bad Horse.
If Bad Horse is late, time better slow the frak down.
If it looks like chicken, tastes like chicken, and feels like chicken but Bad Horse says its beef, then it’s frakking beef.
If you can see Bad Horse, he can see you. If you can’t see Bad Horse you may be only seconds away from death.
If you come home to find Bad Horse doing your wife, it’s probably best to go fetch a glass of water and stand there in case Bad Horse gets thirsty. There ain’t no future in any other course of action.
If you have five dollars and Bad Horse has five dollars, Bad Horse has more money than you.
If you see Bad Horse crying he will grant you a wish, if your wish is dying.
If you try to introduce your mother to Bad Horse, she’ll introduce you to your biological father.
In order to survive a nuclear attack, you must remember to stop, drop, and be Bad Horse.
Jesus owns and wears a bracelet that reads, “WWBHD?”
Leading hand sanitizers claim they can kill 99.9 percent of germs. Bad Horse can kill 100 percent of whatever the frak he wants.
Life is like a box of chocolates. You never know when Bad Horse is going to kill you.
Little kids enjoy lighting ants on fire with magnifying glasses. Bad Horse enjoys lighting little kids on fire with ants. Scientists have yet to find out how this feat is achieved.
Microsoft has released a new Anti-virus removal tool called Bad Horse. The tool dares the virus to enter the machine.
One time in an airport a guy accidentally called Bad Horse “Bad Norse”. He explained it was an honest mistake and apologised profusely. Bad Horse accepted his apology and politely signed an autograph. Nine months later, the guy’s wife gave birth to a half-human, half-horse creature. The guy knew exactly what had happened, and blames nobody but himself.
Outer space exists because it’s afraid to be on the same planet with Bad Horse.
Oxygen requires Bad Horse to live.
Pee Wee Herman got arrested for masturbating in public. The same day, Bad Horse got an award for masturbating in public.
People say the truth hurts, but it hurts a hell of a lot more when it comes from Bad Horse.
Similar to a Russian Nesting Doll, if you were to break Bad Horse open you would find another Bad Horse inside, only smaller and angrier.
Someone once tried to tell Bad Horse that iron hoofs aren’t the best appendages with which to kill someone/rule something. This has been recorded by historians as the worst mistake anyone has ever made.
Superman owns a pair of Bad Horse pajamas.
Switzerland isn’t really neutral. They just haven’t figured out what side Bad Horse is on yet.
The chief export of Bad Horse is pain.
The most effective form of suicide known to man is to type “Bad Horse” into Google and hit “I’m Feeling Lucky!”.
The only thing we have to fear is fear itself… The only thing fear has to fear is Bad Horse.
The phrase “Made by Bad Horse” is imprinted beneath the surface of China.
The quickest way to a man’s heart is with Bad Horse‘s iron hoof.
There is no ‘ctrl’ button on Bad Horse‘s computer. Bad Horse is always in control. Also, he has no fingers, but mainly it’s the control thing.
There is no neck underneath Bad Horse’ mane. There is only another hoof.
There is no theory of evolution. Just a list of creatures Bad Horse has allowed to live.
They say that lightning never strikes the same place twice. Niether does Bad Horse. He doesn’t have to.
Water boils faster when Bad Horse watches it.
We all know the magic word is please. As in the sentence, “Please don’t kill me.” Too bad Bad Horse doesn’t believe in magic.
When Bad Horse answers the phone, he just whinnies “Go”. This is not permission for you to begin speaking, it is your cue to start running for your life.
When Bad Horse laughs too hard while drinking milk, he accidently shits a cow.
When Bad Horse sends in his taxes, he sends blank forms and includes only a picture of himself, standing stationary with an iron hoof raised. Bad Horse has not had to pay taxes ever.
When Bad Horse was attending the University Of Evil Doing, his Theory professor assigned an essay: “What is Courage?” Bad Horse received an High Distinction for writing only the words “Bad Horse” and promptly turning in the paper.
When the Boogeyman goes to sleep every night he checks his closet for Bad Horse.
When the Incredible Hulk gets angry he transforms into Bad Horse.
When you open a can of whoop-ass, Bad Horse jumps out.
Whenever someone is constipated, doctors send them to Bad Horse so he can scare the shit out of them.'''

def randomList = [];
fullList.eachLine{randomList.add(it)}

int DONT_VIBRATE = 0;
int SHORT_VIBRATE = 1;
int DOUBLE_VIBRATE = 2;
int LONG_VIBRATE = 3;


int hour = 1000 * 60 * 60;
int day = 24 * hour;
def d = new Date();
long mills = d.getTime();
mills += hour * 80;
mills = mills % (hour * 24 * 14);

String urlText = "";
try
{
	Random r = new Random();
	urlText = "https://www.dropbox.com/s/acmx4rn73aotbvo/Pebble%20Cards%20Override.txt?dl=1&rand=${r.nextInt()}".toURL().getText();
	urlText = urlText.replaceAll(/\r/, "");
	urlText = urlText.replaceAll(/\n/, " ");
}
catch (Exception e) 
{ /*ignore exception */
}

if (urlText.trim() != "")
   request.content = urlText;

else if (mills > 0 && mills < hour * 72)
   request.content = "Green trash-only week";
else if (mills > (7 * day) && mills < (7 * day) + (hour * 72))
   request.content = "Gold recycling week";
else 
{
   //def randomList = ["Don't forget to be awesome",
   //                  "Execute order 66",
   //                  "My life for Aiur"];
   Collections.shuffle(randomList);
   request.content = randomList[0];
}


request.frequency = 120;
request.vibrate = DONT_VIBRATE;

//////////////

forward '/WEB-INF/pages/pebblecards.gtpl'

//////////////

